<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>REST API Tester</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; line-height: 1.6; color: #333; max-width: 900px; margin: 20px auto; padding: 0 15px; background-color: #f9f9f9; }
        h1, h2 { border-bottom: 2px solid #eee; padding-bottom: 10px; }
        .endpoint { background-color: #fff; border: 1px solid #ddd; border-radius: 8px; padding: 20px; margin-bottom: 25px; }
        .endpoint h2 { margin-top: 0; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input[type="text"], input[type="number"], textarea { width: 100%; padding: 8px; margin-bottom: 10px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }
        button { background-color: #007bff; color: white; padding: 10px 15px; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; }
        button:hover { background-color: #0056b3; }
        pre { background-color: #2d2d2d; color: #f1f1f1; padding: 15px; border-radius: 4px; white-space: pre-wrap; word-wrap: break-word; max-height: 400px; overflow-y: auto; }
        .method { font-size: 0.8em; font-weight: bold; color: #fff; padding: 3px 8px; border-radius: 3px; display: inline-block; margin-left: 10px; }
        .get { background-color: #61affe; }
        .post { background-color: #28a745; }
        .note { font-size: 0.9em; color: #666; background-color: #f0f0f0; padding: 10px; border-left: 3px solid #007bff; margin-top: 10px; border-radius: 4px;}
        .config { background-color: #fff3cd; border-left: 3px solid #ffc107; padding: 10px; margin-bottom: 20px; }
    </style>
</head>
<body>

    <h1>NFT Ticketing REST API Tester</h1>
    <div class="config">
        <strong>API Base URL:</strong> 
        <input type="text" id="api-base-url" value="http://localhost:3001" style="width: 300px; display: inline-block;">
        <p class="note">Make sure your REST API server is running on this URL before testing!</p>
    </div>

    <!-- Health Check -->
    <div class="endpoint">
        <h2>Health Check <span class="method get">GET</span></h2>
        <p class="note">Check if the server is running.</p>
        <button onclick="testHealthCheck()">Test Health Check</button>
        <pre id="health-response">Response will appear here...</pre>
    </div>

    <!-- Auth Verify -->
    <div class="endpoint">
        <h2>POST /api/auth/verify <span class="method post">POST</span></h2>
        <p class="note">Verifies a wallet signature to authenticate a user. You need to sign a message with your wallet first.</p>
        <form id="auth-verify-form">
            <label for="auth-message">Message:</label>
            <input type="text" id="auth-message" value="Please sign this message to authenticate.">
            <label for="auth-signature">Signature:</label>
            <input type="text" id="auth-signature" placeholder="0x...">
            <label for="auth-address">Wallet Address:</label>
            <input type="text" id="auth-address" placeholder="0x...">
            <button type="submit">Test Auth Verify</button>
        </form>
        <pre id="auth-verify-response">Response will appear here...</pre>
    </div>

    <!-- Get All Events -->
    <div class="endpoint">
        <h2>GET /api/events <span class="method get">GET</span></h2>
        <p class="note">Retrieves all events from the database.</p>
        <button onclick="testGetAllEvents()">Test Get All Events</button>
        <pre id="get-events-response">Response will appear here...</pre>
    </div>

    <!-- Helper: Get Users -->
    <div class="endpoint">
        <h2>GET /api/events/users <span class="method get">GET</span></h2>
        <p class="note">ðŸ”§ Helper: Get existing users to find a valid organizer_id</p>
        <button onclick="testGetUsers()">Get Users</button>
        <pre id="get-users-response">Response will appear here...</pre>
    </div>

    <!-- Helper: Create Test User -->
    <div class="endpoint">
        <h2>POST /api/events/test-user <span class="method post">POST</span></h2>
        <p class="note">ðŸ”§ Helper: Create a test user to use as an organizer</p>
        <form id="create-user-form">
            <label for="cu-wallet">Wallet Address (optional):</label>
            <input type="text" id="cu-wallet" placeholder="Leave empty for random wallet">
            <label for="cu-username">Username (optional):</label>
            <input type="text" id="cu-username" placeholder="Leave empty for auto-generated">
            <button type="submit">Create Test User</button>
        </form>
        <pre id="create-user-response">Response will appear here...</pre>
    </div>

    <!-- Get Single Event -->
    <div class="endpoint">
        <h2>GET /api/events/:id <span class="method get">GET</span></h2>
        <p class="note">Retrieves a single event by ID along with its tickets.</p>
        <form id="get-event-form">
            <label for="get-event-id">Event ID:</label>
            <input type="text" id="get-event-id" value="1">
            <button type="submit">Test Get Event</button>
        </form>
        <pre id="get-event-response">Response will appear here...</pre>
    </div>

    <!-- Create Event -->
    <div class="endpoint">
        <h2>POST /api/events <span class="method post">POST</span></h2>
        <p class="note">Creates a new event. (Note: Auth middleware is currently disabled)</p>
        <form id="create-event-form">
            <label for="ce-organizer-id">Organizer ID (UUID):</label>
            <input type="text" id="ce-organizer-id" placeholder="User UUID from database">
            <label for="ce-title">Event Title:</label>
            <input type="text" id="ce-title" value="Amazing Concert 2025">
            <label for="ce-description">Description:</label>
            <textarea id="ce-description" rows="2">The most amazing concert of the year!</textarea>
            <label for="ce-start-date">Start Date (ISO 8601):</label>
            <input type="text" id="ce-start-date" value="2025-12-31T20:00:00Z">
            <label for="ce-end-date">End Date (ISO 8601):</label>
            <input type="text" id="ce-end-date" value="2025-12-31T23:59:00Z">
            <label for="ce-location">Location:</label>
            <input type="text" id="ce-location" value="Madison Square Garden">
            <label for="ce-venue-name">Venue Name:</label>
            <input type="text" id="ce-venue-name" value="Madison Square Garden">
            <label for="ce-category">Category:</label>
            <input type="text" id="ce-category" value="concert" placeholder="concert, sports, theater, etc.">
            <label for="ce-total-supply">Total Supply (Tickets):</label>
            <input type="number" id="ce-total-supply" value="1000">
            <label for="ce-banner-url">Banner Image URL:</label>
            <input type="text" id="ce-banner-url" placeholder="https://example.com/banner.jpg">
            <label for="ce-thumbnail-url">Thumbnail Image URL:</label>
            <input type="text" id="ce-thumbnail-url" placeholder="https://example.com/thumb.jpg">
            <button type="submit">Test Create Event</button>
        </form>
        <pre id="create-event-response">Response will appear here...</pre>
    </div>

    <!-- Mint Ticket -->
    <div class="endpoint">
        <h2>POST /api/tickets/mint <span class="method post">POST</span></h2>
        <p class="note">Mints a new ticket NFT for a user for a specific event.</p>
        <form id="mint-ticket-form">
            <label for="mt-event-id">Event ID:</label>
            <input type="text" id="mt-event-id" value="1">
            <label for="mt-user-wallet">User Wallet Address:</label>
            <input type="text" id="mt-user-wallet" placeholder="0x...">
            <button type="submit">Test Mint Ticket</button>
        </form>
        <pre id="mint-ticket-response">Response will appear here...</pre>
    </div>

    <!-- Check-in -->
    <div class="endpoint">
        <h2>POST /api/checkin/check-in <span class="method post">POST</span></h2>
        <p class="note">Checks in a user for an event using their ticket token ID.</p>
        <form id="checkin-form">
            <label for="ci-token-id">Token ID:</label>
            <input type="text" id="ci-token-id" placeholder="NFT Token ID (number)">
            <button type="submit">Test Check-in</button>
        </form>
        <pre id="checkin-response">Response will appear here...</pre>
    </div>

    <!-- List Ticket -->
    <div class="endpoint">
        <h2>POST /api/marketplace/list-ticket <span class="method post">POST</span></h2>
        <p class="note">Lists a ticket on the marketplace.</p>
        <form id="list-ticket-form">
            <label for="lt-token-id">Token ID:</label>
            <input type="text" id="lt-token-id" placeholder="NFT Token ID">
            <label for="lt-price">Price (in ETH):</label>
            <input type="text" id="lt-price" value="0.1">
            <button type="submit">Test List Ticket</button>
        </form>
        <pre id="list-ticket-response">Response will appear here...</pre>
    </div>

    <!-- Unlist Ticket -->
    <div class="endpoint">
        <h2>POST /api/marketplace/unlist-ticket <span class="method post">POST</span></h2>
        <p class="note">Removes a ticket listing from the marketplace.</p>
        <form id="unlist-ticket-form">
            <label for="ut-token-id">Token ID:</label>
            <input type="text" id="ut-token-id" placeholder="NFT Token ID">
            <button type="submit">Test Unlist Ticket</button>
        </form>
        <pre id="unlist-ticket-response">Response will appear here...</pre>
    </div>

    <!-- Buy Ticket -->
    <div class="endpoint">
        <h2>POST /api/marketplace/buy-ticket <span class="method post">POST</span></h2>
        <p class="note">Purchases a ticket from the marketplace.</p>
        <form id="buy-ticket-form">
            <label for="bt-token-id">Token ID:</label>
            <input type="text" id="bt-token-id" placeholder="NFT Token ID">
            <label for="bt-buyer-address">Buyer Address:</label>
            <input type="text" id="bt-buyer-address" placeholder="0x...">
            <button type="submit">Test Buy Ticket</button>
        </form>
        <pre id="buy-ticket-response">Response will appear here...</pre>
    </div>

    <script>
        function getApiBaseUrl() {
            return document.getElementById('api-base-url').value;
        }

        async function makeRequest(endpoint, method = 'GET', body = null) {
            const url = `${getApiBaseUrl()}${endpoint}`;
            const options = {
                method: method,
                headers: {
                    'Content-Type': 'application/json',
                }
            };
            
            if (body) {
                options.body = JSON.stringify(body);
            }

            try {
                const response = await fetch(url, options);
                const data = await response.json();
                return {
                    status: response.status,
                    statusText: response.statusText,
                    data: data
                };
            } catch (error) {
                return {
                    status: 'Error',
                    error: error.message
                };
            }
        }

        function displayResponse(elementId, response) {
            const element = document.getElementById(elementId);
            element.textContent = JSON.stringify(response, null, 2);
        }

        // Health Check
        async function testHealthCheck() {
            const responseEl = document.getElementById('health-response');
            responseEl.textContent = 'Loading...';
            try {
                const response = await fetch(`${getApiBaseUrl()}/`);
                const text = await response.text();
                displayResponse('health-response', {
                    status: response.status,
                    statusText: response.statusText,
                    body: text
                });
            } catch (error) {
                responseEl.textContent = `Error: ${error.message}`;
            }
        }

        // Auth Verify
        document.getElementById('auth-verify-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const responseEl = document.getElementById('auth-verify-response');
            responseEl.textContent = 'Loading...';
            
            const body = {
                message: document.getElementById('auth-message').value,
                signature: document.getElementById('auth-signature').value,
                address: document.getElementById('auth-address').value
            };
            
            const response = await makeRequest('/api/auth/verify', 'POST', body);
            displayResponse('auth-verify-response', response);
        });

        // Get All Events
        async function testGetAllEvents() {
            const responseEl = document.getElementById('get-events-response');
            responseEl.textContent = 'Loading...';
            const response = await makeRequest('/api/events', 'GET');
            displayResponse('get-events-response', response);
        }

        // Get Users
        async function testGetUsers() {
            const responseEl = document.getElementById('get-users-response');
            responseEl.textContent = 'Loading...';
            const response = await makeRequest('/api/events/users', 'GET');
            displayResponse('get-users-response', response);
        }

        // Create Test User
        document.getElementById('create-user-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const responseEl = document.getElementById('create-user-response');
            responseEl.textContent = 'Loading...';
            
            const body = {
                wallet_address: document.getElementById('cu-wallet').value || undefined,
                username: document.getElementById('cu-username').value || undefined
            };
            
            const response = await makeRequest('/api/events/test-user', 'POST', body);
            displayResponse('create-user-response', response);
        });

        // Get Single Event
        document.getElementById('get-event-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const responseEl = document.getElementById('get-event-response');
            responseEl.textContent = 'Loading...';
            
            const eventId = document.getElementById('get-event-id').value;
            const response = await makeRequest(`/api/events/${eventId}`, 'GET');
            displayResponse('get-event-response', response);
        });

        // Create Event
        document.getElementById('create-event-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const responseEl = document.getElementById('create-event-response');
            responseEl.textContent = 'Loading...';
            
            const body = {
                organizer_id: document.getElementById('ce-organizer-id').value,
                title: document.getElementById('ce-title').value,
                description: document.getElementById('ce-description').value,
                start_date: document.getElementById('ce-start-date').value,
                end_date: document.getElementById('ce-end-date').value,
                location: document.getElementById('ce-location').value,
                venue_name: document.getElementById('ce-venue-name').value,
                category: document.getElementById('ce-category').value,
                total_supply: parseInt(document.getElementById('ce-total-supply').value),
                banner_url: document.getElementById('ce-banner-url').value,
                thumbnail_url: document.getElementById('ce-thumbnail-url').value
            };
            
            const response = await makeRequest('/api/events', 'POST', body);
            displayResponse('create-event-response', response);
        });

        // Mint Ticket
        document.getElementById('mint-ticket-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const responseEl = document.getElementById('mint-ticket-response');
            responseEl.textContent = 'Loading...';
            
            const body = {
                event_id: document.getElementById('mt-event-id').value,
                user_wallet: document.getElementById('mt-user-wallet').value
            };
            
            const response = await makeRequest('/api/tickets/mint', 'POST', body);
            displayResponse('mint-ticket-response', response);
        });

        // Check-in
        document.getElementById('checkin-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const responseEl = document.getElementById('checkin-response');
            responseEl.textContent = 'Loading...';
            
            const body = {
                tokenId: document.getElementById('ci-token-id').value
            };
            
            const response = await makeRequest('/api/checkin/check-in', 'POST', body);
            displayResponse('checkin-response', response);
        });

        // List Ticket
        document.getElementById('list-ticket-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const responseEl = document.getElementById('list-ticket-response');
            responseEl.textContent = 'Loading...';
            
            const body = {
                tokenId: document.getElementById('lt-token-id').value,
                price: document.getElementById('lt-price').value
            };
            
            const response = await makeRequest('/api/marketplace/list-ticket', 'POST', body);
            displayResponse('list-ticket-response', response);
        });

        // Unlist Ticket
        document.getElementById('unlist-ticket-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const responseEl = document.getElementById('unlist-ticket-response');
            responseEl.textContent = 'Loading...';
            
            const body = {
                tokenId: document.getElementById('ut-token-id').value
            };
            
            const response = await makeRequest('/api/marketplace/unlist-ticket', 'POST', body);
            displayResponse('unlist-ticket-response', response);
        });

        // Buy Ticket
        document.getElementById('buy-ticket-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const responseEl = document.getElementById('buy-ticket-response');
            responseEl.textContent = 'Loading...';
            
            const body = {
                tokenId: document.getElementById('bt-token-id').value,
                buyerAddress: document.getElementById('bt-buyer-address').value
            };
            
            const response = await makeRequest('/api/marketplace/buy-ticket', 'POST', body);
            displayResponse('buy-ticket-response', response);
        });
    </script>
</body>
</html>
